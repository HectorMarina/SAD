package TicTacToe;

import java.awt.Color;
import java.awt.Font;
import java.awt.Image;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;
import java.io.IOException;
import javax.sound.sampled.AudioSystem;
import javax.sound.sampled.Clip;
import javax.sound.sampled.LineUnavailableException;
import javax.sound.sampled.UnsupportedAudioFileException;
import javax.swing.ImageIcon;
import javax.swing.JButton;
import javax.swing.JLabel;
import javax.swing.JOptionPane;
import javax.swing.JPanel;
import javax.swing.SwingConstants;

public class Tablero extends JPanel implements ActionListener {

    private final JButton[][] casillas = new JButton[Constants.FILAS][Constants.COLUMNAS];//Creamos las casillas

    private final ImageIcon casillaVacia = new ImageIcon("casillaVacia.png");//Creamos la imagen de casilla vacía
    private final ImageIcon casillaX = new ImageIcon("x.png");//Creamos la imagen de casilla X
    private final ImageIcon casillaO = new ImageIcon("o.png");//Creamos la imagen de casilla O
    private int turno = 0;
    JLabel jugador1 = new JLabel();
    JLabel jugador2 = new JLabel();
    JButton restart = new JButton("Restart");
    JButton menu = new JButton("Menu");
    JButton sonido = new JButton("Sound on");
    JButton exit = new JButton("Exit");
    JButton opciones = new JButton("Options");
    private boolean sound = true;

    public Tablero() {
        iniciarComponentes();

    }

    private void iniciarComponentes() {
        putPanel();
        putTablero();
        putCasillas();
        menuOpciones();
    }

    private void putPanel() {
        this.setLayout(null);//Desactivando el diseño
        this.setBackground(Color.WHITE);//Ajustamos el color de fondo a blanco

    }

    private void putTablero() {
        //Etiqueta tipo Texto
        JLabel titulo = new JLabel("Tic Tac Toe");//Creamos el label
        titulo.setFont(new Font("arial", Font.BOLD, 30));//Establecemos tipo de fuente y  tamaño
        titulo.setBounds(85, 10, 300, 80);//Establecemos el tamaño y posicion de la etiqueta
        titulo.setHorizontalAlignment(SwingConstants.CENTER);//Establecemos la alineacion horizontal del texto (Se puede poner en el constructor)

        //Etiqueta tipo imagen
        ImageIcon imagen = new ImageIcon("tablero.png");//Creamos una imagen
        JLabel tablero = new JLabel(); //Creamos el label
        tablero.setBounds(80, 80, 300, 300);//Ponemos el tamaño y posición del label
        tablero.setIcon(new ImageIcon(imagen.getImage().getScaledInstance(tablero.getWidth(), tablero.getHeight(), Image.SCALE_SMOOTH)));//Estabelecemos medidaas de la imagen y la adaptacmos al label

        this.add(titulo);//Añadimos las etiquetas al panel
        this.add(tablero);

        //Etiqueta tipo texto
        jugador1.setBounds(80, 400, 200, 25);
        jugador1.setFont(new Font("arial", Font.BOLD, 20));
        jugador2.setBounds(250, 400, 200, 25);
        jugador2.setFont(new Font("arial", Font.BOLD, 20));
        this.add(jugador1);
        this.add(jugador2);
    }

    private void putCasillas() {
        int y = 0;
        int x = 0;
        for (int i = 0; i < Constants.FILAS; i++) {
            for (int j = 0; j < Constants.COLUMNAS; j++) {
                switch (i) {
                    case 0:
                        y = Constants.Y1;
                        break;
                    case 1:
                        y = Constants.Y2;
                        break;
                    case 2:
                        y = Constants.Y3;
                        break;
                }
                switch (j) {
                    case 0:
                        x = Constants.X1;
                        break;
                    case 1:
                        x = Constants.X2;
                        break;
                    case 2:
                        x = Constants.X3;
                        break;
                }
                casillas[i][j] = new JButton();//Creamos el boton
                casillas[i][j].setBounds(x, y, Constants.SQUARE, Constants.SQUARE);//Dimensionamos y decidimos su posición
                casillas[i][j].setBorderPainted(false);//Quitamos los bordes del boton
                casillas[i][j].setIcon(new ImageIcon(casillaVacia.getImage().getScaledInstance(casillas[i][j].getWidth(), casillas[i][j].getHeight(), Image.SCALE_SMOOTH)));//Dimensionamos la imagen segun el boton
                casillas[i][j].addActionListener(this);//Añadimos el ActionListener a las casillas
                this.add(casillas[i][j]);//Añadimos el boton al panel

            }
        }
    }

    @Override
    public void actionPerformed(ActionEvent e) {
        if (e.getSource().equals(restart)) {
            for (int i = 0; i < Constants.FILAS; i++) {
                for (int j = 0; j < Constants.COLUMNAS; j++) {
                    casillas[i][j].setIcon(new ImageIcon(casillaVacia.getImage().getScaledInstance(casillas[i][j].getWidth(), casillas[i][j].getHeight(), Image.SCALE_SMOOTH)));//Dimensionamos la imagen segun el boton
                    casillas[i][j].setEnabled(true);
                }
            }
            turno = 0;
        } else if (e.getSource().equals(exit)) {
            System.exit(0);
        } else if (e.getSource().equals(sonido)) {
            sound = !sound;
            if (!sound) {
                sonido.setText("Sonido off");
            } else {
                sonido.setText("Sonido on");
            }
        } else if (e.getSource().equals(opciones)) {
            JOptionPane.showMessageDialog(null, " Press alt + m(Menu) / r(Restart) / s(Sound on/off) / e(Exit)", "Options", 1);
        } else {
            JButton casilla = (JButton) e.getSource();

            if (turno % 2 == 0) {//Si es el turno de X
                casilla.setIcon(new ImageIcon(casillaX.getImage().getScaledInstance(casilla.getWidth(), casilla.getHeight(), Image.SCALE_SMOOTH)));//Colocamos la figura correspondiente X

            } else {//Si es el turno de O
                casilla.setIcon(new ImageIcon(casillaO.getImage().getScaledInstance(casilla.getWidth(), casilla.getHeight(), Image.SCALE_SMOOTH)));//Colocamos la figura correspondiente X
            }
            turno++;//Pasamos el turno
            if (sound) {
                reproducirSonido();
            }
        }
    }

    private void reproducirSonido() {
        try {
            // Se obtiene un Clip de sonido
            Clip s = AudioSystem.getClip();

            // Se carga con un fichero wav
            s.open(AudioSystem.getAudioInputStream(new File("ficha.wav")));

            // Comienza la reproducción
            s.start();

        } catch (IOException | LineUnavailableException | UnsupportedAudioFileException ex) {
            System.out.println("" + ex);
        }
    }

    private void menuOpciones() {
        menu.setBounds(450, 120, 100, 20);//Dimensionamos los botones y los posicionamos
        restart.setBounds(450, 170, 100, 20);
        sonido.setBounds(450, 220, 100, 20);
        exit.setBounds(450, 270, 100, 20);
        opciones.setBounds(450, 320, 100, 20);
        menu.setBackground(Color.WHITE);
        restart.setBackground(Color.WHITE);
        sonido.setBackground(Color.WHITE);
        exit.setBackground(Color.WHITE);
        opciones.setBackground(Color.WHITE);
        menu.setFont(new Font("arial", Font.BOLD, 12));
        restart.setFont(new Font("arial", Font.BOLD, 12));
        sonido.setFont(new Font("arial", Font.BOLD, 12));
        exit.setFont(new Font("arial", Font.BOLD, 12));
        opciones.setFont(new Font("arial", Font.BOLD, 12));
        menu.addActionListener(this);
        restart.addActionListener(this);
        sonido.addActionListener(this);
        exit.addActionListener(this);
        opciones.addActionListener(this);
        menu.setMnemonic('m');
        restart.setMnemonic('r');
        sonido.setMnemonic('s');
        exit.setMnemonic('e');
        this.add(menu);//Añadimos los botones al panel
        this.add(restart);
        this.add(sonido);
        this.add(exit);
        this.add(opciones);
    }
}
